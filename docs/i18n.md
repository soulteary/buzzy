# 国际化 (i18n)

Buzzy 使用 Rails I18n，默认语言为英语，已支持**中文（zh）**。语言偏好保存在 `Identity` 上，个人资料页可切换；请求中由 `SetLocale` 根据 params/session/identity 设置 `I18n.locale`。

---

## 当前支持

- **语言**：`config.i18n.available_locales = [:en, :zh]`，默认 `default_locale = :en`。
- **语言包**：`config/locales/en/`、`config/locales/zh/` 分模块（boards、cards、shared、users、sessions、notifications、filters 等），根级 `en.yml`、`zh.yml`。
- **回退**：`config.i18n.fallbacks = true`（缺失 key 回退到默认语言）。测试环境可开启 `raise_on_missing_translations` 以发现未翻译 key。

---

## 添加新语言

1. **复制语言包**：将 `config/locales/en/` 整目录复制为 `config/locales/<locale>/`（如 `es`）。
2. **翻译**：保留 key 结构，只改字符串值。
3. **注册**：在 `config/application.rb` 中把新 locale 加入 `config.i18n.available_locales`。
4. **选择器名称**：在 `config/locales/en/locales.yml` 的 `locales.name` 下添加如 `es: "Spanish"`；在 `config/locales/es/locales.yml` 中添加 `es: "Español"`、`en: "English"` 等，供语言选择器显示。
5. **迁移**：`identities.locale` 列已存在，无需新增迁移。

---

## 技术说明

- **Key 组织**：优先使用 `config/locales/<locale>/` 下按模块的命名空间，如 `cards.container.edit`、`boards.new.page_title`。
- **插值**：YAML 中用 `%{name}`，调用 `t("key", name: value)`。
- **HTML**：需输出 HTML 的翻译使用以 `_html` 结尾的 key，并在受信任处传 `_html: true` 或使用 `.html_safe`。
- **返回链接**：`ApplicationHelper#back_link_to` 使用 `shared.back_to_label`（如 "Back to %{label}"）与页面 label 拼出整句，便于多语言统一。

参考：[Rails I18n 指南](https://guides.rubyonrails.org/i18n.html)
